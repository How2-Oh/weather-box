{"name":"Weather-box","tagline":"A TI SensorTag-based weather station with automatic Bluetooth advertising.","body":"#Weather Box\r\n\r\nHigh expectations and enthusiasm for easy Internet of Things (IoT) Cloud-based projects based on the Texas Instruments (TI) CC2650 SensorTag (aka SensorTag 2.0) quickly dissipated into a ho-hum “nice idea, but …” afterthought. Why? It’s tough to wrangle the Bluetooth “smart” connectivity into a simple, practical project. Here’s the problem: SensorTag attempts to establish a link with a Bluetooth Low Energy compliant device by advertising its device ID for approximately 2 minutes. This advertising period is initiated by a user pressing a button located on SensorTag. This direct user physical contact handicaps installing SensorTag in a remote or inaccessible area. Unfortunately, one of the primary use applications for SensorTag is in a remote sensor node weather station configuration.\r\n\r\nOne of the more common solutions to this irritating limitation is to modify the SensorTag firmware for continuous Bluetooth advertising. In other words, removing the 2 minute operation limit on the SensorTag and thereby enabling it to keep its CC2650 Bluetooth “Smart” microcontroller unit (MCU) ON all of the time. See this discussion about this process:\r\n\r\n“How to modify the TI SensorTag (CC2650STK) Firmware to advertise indefinitely?\r\n(stackoverflow.com/questions/30076938/how-to-modify-the-ti-sensortag-cc2650stk-firmware-to-advertise-indefinitely)\r\n\r\nThis solution seems to preclude one of SensorTag’s greatest attributes: low-power consumption; or, “… lets the device operate on small coin cell batteries and in energy-harvesting applications.”\r\n\r\n—see TIDU862-March 2015\r\n\r\nThis project presents an entirely different way of looking at SensorTag and enabling it to be easily slipped into any remote installation application. Here’s the TL;DR version:\r\n\r\nConnect a relay to SensorTag and trip it at predefined intervals.\r\n\r\n##Background\r\n\r\nTexas Instruments has managed to pack an impressive array of sensors and features into a ridiculously small battery-powered package. Included with SensorTag are:\r\n\r\n- Accelerometer\r\n- Ambient light sensor\r\n- Ambient temperature sensor\r\n- Barometric pressure sensor\r\n- Bluetooth Smart CC2650 MCU\r\n- Buzzer\r\n- CR2032 battery operation\r\n- Gyroscope\r\n- Humidity sensor\r\n- Infrared temperature sensor\r\n- Green LED\r\n- Red LED\r\n- Magnetic (Reed-like) sensor\r\n- Magnetometer\r\n- Microphone\r\n\r\nIn addition to its small physical size, SensorTag is also small in its price sticker with a MSRP of $30.\r\n\r\nRemarkably, a complete sensor node weather station can be built with SensorTag plus a couple of low-cost parts. This project is the Weather Box.\r\n\r\nWeather Box consists of a 3D-printed enclosure that houses SensorTag, an external MCU, battery, and relay. This relay is used for “flicking” the SensorTag advertising switch. The timing for this relay operation is performed by the external MCU. During inactivity, the MCU is placed into a “deep sleep” mode so that battery life can be preserved. In fact, the expected battery life for Weather Box is about 100+ days. This longevity is exclusive of the SensorTag battery; although TI claims a similar long operational life for its Bluetooth device.\r\n\r\nOnce a Bluetooth link has been established with Weather Box, reading the sensor node can be accomplished with the TI SensorTag app (FREE). This app provides a barebones utilitarian view of all sensor data. Furthermore, this data can be sent to an IBM Cloud service for interaction by mobile devices. For example, Weather Box data could be received via messaging texts that are distributed with IoT scripts and recipes.\r\n\r\nAnother method of using Weather Box data is with a paid app called MyWeatherCenter (by Flaschengeist Studios; myweathercenter.net). Unlike the TI app, this app provides an integrated weather view that combines local SensorTag data with national/international weather forecasts.\r\n\r\n##The Build\r\n\r\nYou can either build this project freeform (this can be challenging) or use this kit (this is the easiest way to get going):\r\n\r\nSparkFun H2OhNo! ATtiny Dev Board/Water Alarm DEV-12069\r\n(https://www.sparkfun.com/products/12069)\r\n\r\nEither way, the parts required are:\r\n\r\n- Atmel AVR ATtiny85\r\n- 20mm Coin cell battery holder\r\n- CR2032 Coin cell battery\r\n- Switch (or, 2-pin Header with jumper shunt)\r\n- Jumper wire\r\n[You don’t have to use/solder the remaining parts from this kit.]\r\n\r\nAnd this part:\r\n\r\n- IXYS LCA710 Single Pole, Normally Open OptMOS Relay from BGMicro #REL1133 (bgmicro.com).\r\n\r\nAnd, naturally, this part, too:\r\n\r\n- TI SensorTag CC2650 2.0\r\n\r\nAssembling instructions for the kit are here:\r\n\r\nH2OhNo! Tutorial\r\n(https://learn.sparkfun.com/tutorials/h2ohno)\r\n\r\nThere are several ways to program the ATtiny85, the easiest method is to use this AVR programmer:\r\n\r\nTiny AVR Programmer SparkFun PGM-11801\r\n(https://www.sparkfun.com/products/11801)\r\n\r\nFinally, setting up the Arduino Integrated Development Environment (IDE) for programming the ATtiny85, can be found here:\r\n\r\nTiny AVR Programmer Hookup Guide\r\n(https://learn.sparkfun.com/tutorials/tiny-avr-programmer-hookup-guide/)\r\n\r\nAfter all of these choices and steps have been completed, follow these steps for assembling Weather Box:\r\n\r\nStep 1. Remove the SensorTag container from its red rubber jacket (NB: that’s TI nomenclature, not mine), lift the clear lid off the container, and remove the battery. Set these pieces aside for reassembly in a later step.\r\n\r\nStep 2. Locate and remove switch SW1 (ON/OFF). This is a Diptronics MTA2-WNC-V-T/R switch. In order to understand the layout of this component, read the datasheet for this switch before you remove it.\r\n\r\nStep 3. Use a multimeter to determine which of the switch’s pads is connected to GND (i.e., a continuity test between the negative battery terminal (Bat-) and each pad). Use a black wire (or, blue wire) for soldering to this pad in the next step.\r\n\r\nStep 4. Solder a single wire to each of the switch’s contact pads, tape these wires to the SensorTag PCB, route the wires outside of the container and through a slit in the red rubber jacket, reinstall the battery, and reassemble the parts that you set aside in Step 1. Test your modification by touching the two wires together: the SensorTag green LED should begin flashing and the Bluetooth MCU should begin advertising.\r\n\r\nStep 5. Snip off and discard pin #3 on the IXYS relay. Solder pins #4 and #6 together on the relay. Connect these joint combined pins to the red wire (or, non-GND wire) from SensorTag as determined in Step 4 and the black or blue wire from SensorTag (from Step 3) to the relay’s pin #5.\r\n\r\nStep 6. Solder a wire from pin #1 of the relay to pin #5 of the ATtiny85 (or, the appropriate pad for this pin on the H2OhNo! PCB) and another wire from pin #2 of the relay to the GND pin of the ATtiny85 (i.e., pin #4).\r\n\r\nStep 7. Connect a battery to the ATtiny85 or insert a battery into the H2OhNo! PCB and slide the power switch to ON. Every five (5) minutes the ATtiny85 will wake up and trigger the relay. This triggering action will activate the SensorTag Bluetooth advertising system. The Bluetooth advertising lasts approximately two (2) minutes. During this advertising period, use your smartphone to locate Weather Box with the FREE TI SensorTag app.\r\n\r\nYou should be able to see the SensorTag green LED flashing through the slats on the back of the red rubber jacket. If you don’t immediately see SensorTag in the app, ensure that your mobile device has its Bluetooth service active and try to reconnect to Weather Box after several minutes. There is a two-minute window for pairing a device with Weather Box every five minutes, or, about three (3) minutes of SensorTag inactivity.\r\n\r\n##Installation\r\n\r\nThere are two STL format files for printing an enclosure for Weather Box. This enclosure has a sliding door, as well as an opening shaped like a sun on one side. Slide SensorTag, ATtiny85, battery, and relay into the enclosure. For proper weather reading, ensure that the SensorTag red rubber jacket slats are facing the sun pictographic opening on the side of the enclosure.\r\n\r\nFind a suitable location outside for installing Weather Box. Avoid areas with direct sunlight and those that can get wet from precipitation. Use the small handle on the top of 3D-printed enclosure for hanging Weather Box. This installation will allow you to use accelerometer data for measuring wind speed.\r\n\r\nYour Weather Box is now ready for use.\r\n\r\n- Files for Weather Box:\r\n\r\n- Pix = Photographs of Weather Box.\r\n\r\n- STLFiles = the 3D STL format files for printing the Weather Box enclosure\r\n\r\n- Code = the Arduino IDE INO code for programming the ATtiny85\r\n\r\n- Readme.md = this file","google":"","note":"Don't delete this file! It's used internally to help with page regeneration."}